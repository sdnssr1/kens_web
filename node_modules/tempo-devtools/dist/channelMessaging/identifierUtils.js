"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.isElementInSvg = exports.isSkipNavTreeNode = exports.isMovingElement = exports.getAllUnknownClasses = exports.getAllUnknownClasesFromList = exports.isOutline = exports.hasClass = exports.removeUniqueLookupFromNode = exports.getUniqueLookupFromNode = exports.getElementKeyFromNode = exports.addCodebaseIdToNode = exports.addUniqueLookupAsClass = exports.addElementKeyAsClass = exports.getCodebaseIdFromNode = exports.getCodebaseIdFromClassName = exports.validateUuid = exports.KNOWN_ATTRIBUTES = exports.TEMPO_QUEUE_DELETE_AFTER_HOT_RELOAD = exports.TEMPO_TEST_ID = exports.TEMPO_ELEMENT_ID = exports.TEMPO_DO_NOT_SHOW_IN_NAV_UNTIL_REFRESH = exports.TEMPO_OUTLINE_UNTIL_REFESH = exports.TEMPO_DELETE_AFTER_REFRESH = exports.TEMPO_INSTANT_UPDATE = exports.TEMPO_DELETE_AFTER_INSTANT_UPDATE = exports.TEMPO_DISPLAY_NONE_UNTIL_REFRESH_CLASS = exports.TEMPO_INSTANT_UPDATE_STYLING_PREFIX = exports.TEMPO_MOVE_BETWEEN_PARENTS_OUTLINE = exports.TEMPO_INSTANT_DIV_DRAW_CLASS = exports.EDIT_TEXT_BUTTON = exports.OUTLINE_CLASS = exports.UNIQUE_LOOKUP_PREFIX = exports.ELEMENT_KEY_PREFIX = void 0;
const changeItemFunctions_1 = require("./changeItemFunctions");
// Must match identifier utils on the frontend
exports.ELEMENT_KEY_PREFIX = 'arb89-key-';
exports.UNIQUE_LOOKUP_PREFIX = 'arb89-lookup-'; // Used only for processing the nav tree
exports.OUTLINE_CLASS = 'arb89-outline';
exports.EDIT_TEXT_BUTTON = 'arb89-edit-text-button';
exports.TEMPO_INSTANT_DIV_DRAW_CLASS = 'arb89-instant-div-draw';
exports.TEMPO_MOVE_BETWEEN_PARENTS_OUTLINE = 'arb89-move-between-parents-outline';
exports.TEMPO_INSTANT_UPDATE_STYLING_PREFIX = 'arb89-styling-';
exports.TEMPO_DISPLAY_NONE_UNTIL_REFRESH_CLASS = 'arb89-display-none-until-refresh';
exports.TEMPO_DELETE_AFTER_INSTANT_UPDATE = 'arb89-delete-after-instant-update';
const KNOWN_CLASSES = new Set([
    exports.OUTLINE_CLASS,
    exports.TEMPO_INSTANT_DIV_DRAW_CLASS,
    exports.TEMPO_MOVE_BETWEEN_PARENTS_OUTLINE,
    exports.TEMPO_DISPLAY_NONE_UNTIL_REFRESH_CLASS,
    changeItemFunctions_1.WRAP_IN_DIV_PLACEHOLDER_CODEBASE_ID,
    changeItemFunctions_1.TEMPORARY_STYLING_CLASS_NAME,
    exports.EDIT_TEXT_BUTTON,
]);
const KNOWN_CLASS_PREFIXES = [
    exports.ELEMENT_KEY_PREFIX,
    exports.UNIQUE_LOOKUP_PREFIX,
    exports.TEMPO_INSTANT_UPDATE_STYLING_PREFIX,
    changeItemFunctions_1.DUPLICATE_PLACEHOLDER_PREFIX,
    changeItemFunctions_1.ADD_JSX_PREFIX,
];
// Attributes that are set until the next Nav Tree Refresh
exports.TEMPO_INSTANT_UPDATE = 'arb89-instant-update';
exports.TEMPO_DELETE_AFTER_REFRESH = 'arb89-delete-after-refresh';
exports.TEMPO_OUTLINE_UNTIL_REFESH = 'arb89-outline-until-refresh';
exports.TEMPO_DO_NOT_SHOW_IN_NAV_UNTIL_REFRESH = 'arb89-do-not-show-in-nav';
exports.TEMPO_ELEMENT_ID = 'tempoelementid';
exports.TEMPO_TEST_ID = 'data-testid';
exports.TEMPO_QUEUE_DELETE_AFTER_HOT_RELOAD = 'arb89-queue-delete-after-hot-reload';
exports.KNOWN_ATTRIBUTES = new Set([
    exports.TEMPO_INSTANT_UPDATE,
    exports.TEMPO_DELETE_AFTER_REFRESH,
    exports.TEMPO_DELETE_AFTER_INSTANT_UPDATE,
    exports.TEMPO_OUTLINE_UNTIL_REFESH,
    exports.TEMPO_QUEUE_DELETE_AFTER_HOT_RELOAD,
    exports.TEMPO_DO_NOT_SHOW_IN_NAV_UNTIL_REFRESH,
    exports.TEMPO_ELEMENT_ID,
    exports.TEMPO_TEST_ID,
]);
const validateUuid = (uuid) => {
    return new RegExp('^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$', 'i').test(uuid);
};
exports.validateUuid = validateUuid;
const getCodebaseIdFromClassName = (className) => {
    if (className &&
        className.startsWith('tempo-') &&
        ((0, exports.validateUuid)(className.substring('tempo-'.length)) ||
            className === changeItemFunctions_1.WRAP_IN_DIV_PLACEHOLDER_CODEBASE_ID ||
            className.startsWith(changeItemFunctions_1.DUPLICATE_PLACEHOLDER_PREFIX))) {
        return className;
    }
    return null;
};
exports.getCodebaseIdFromClassName = getCodebaseIdFromClassName;
const getCodebaseIdFromNode = (node) => {
    var _a;
    if (!(node === null || node === void 0 ? void 0 : node.classList)) {
        return null;
    }
    let clsFound = null;
    node.classList.forEach((cls) => {
        // A bit of a hack -> in the case when there are multiple tempo codebase IDs on an element
        // we want to use the first one defined. This happens in the case of forward refs, and we
        // always add the bottom-most className to the end of the classes list, so we want to
        // show the top-most element in this case
        if (clsFound) {
            return;
        }
        if (!cls) {
            return;
        }
        const extractedId = (0, exports.getCodebaseIdFromClassName)(cls);
        if (extractedId) {
            clsFound = extractedId;
        }
    });
    if (clsFound) {
        return clsFound;
    }
    if (((_a = node === null || node === void 0 ? void 0 : node.tagName) === null || _a === void 0 ? void 0 : _a.toLowerCase()) == 'body') {
        return 'body';
    }
    if ((node === null || node === void 0 ? void 0 : node.id) == 'root') {
        return 'root';
    }
    if ((node === null || node === void 0 ? void 0 : node.id) == '__next') {
        return '__next';
    }
    return null;
};
exports.getCodebaseIdFromNode = getCodebaseIdFromNode;
// Track how many times we've tried to add an element key class to nodes that keep getting reset
// Some DOM elements are controlled by external libraries/frameworks (e.g. ProseMirror) and will reset any classes or
// wipe out the DOM elements and re-render them.
// We don't want to keep trying indefinitely to add classes to these elements since it the reset will trigger DOM updates
// which again trigger the mutation observer and we'll start the whole process over again.
const resetCounts = new Map();
const RESET_COUNT_THRESHOLD = 5; // Stop trying to add classes after 5 failed attempts
const addElementKeyAsClass = ({ node, safeElementKey, codebaseId, }) => {
    if (!(node === null || node === void 0 ? void 0 : node.classList)) {
        return;
    }
    let successfullySetBefore = false;
    const classesToRemove = new Set();
    node.classList.forEach((cls) => {
        if (cls === null || cls === void 0 ? void 0 : cls.startsWith(exports.ELEMENT_KEY_PREFIX)) {
            successfullySetBefore = true;
            classesToRemove.add(cls);
        }
    });
    // If this element:
    // 1. Doesn't have a codebase ID (meaning it's not one of our components)
    // 2. Has never successfully kept our class before
    // 3. Has hit the reset threshold
    // Then stop trying to add classes to it since it's likely controlled externally
    if (!codebaseId &&
        !successfullySetBefore &&
        (resetCounts.get(safeElementKey) || 0) >= RESET_COUNT_THRESHOLD) {
        return;
    }
    classesToRemove.forEach((cls) => {
        node.classList.remove(cls);
    });
    node.classList.add(`${exports.ELEMENT_KEY_PREFIX}${safeElementKey}`);
    // For elements without a codebase ID that we haven't successfully added a class to before,
    // check after a delay if our class was removed by external code
    // If so, increment the reset count to eventually stop trying
    if (!codebaseId && !successfullySetBefore) {
        setTimeout(() => {
            const element = document.querySelector(`${exports.ELEMENT_KEY_PREFIX}${safeElementKey}`);
            if (!element) {
                resetCounts.set(safeElementKey, (resetCounts.get(safeElementKey) || 0) + 1);
            }
        }, 1000);
    }
};
exports.addElementKeyAsClass = addElementKeyAsClass;
const addUniqueLookupAsClass = (node, uniqueLookup) => {
    if (!(node === null || node === void 0 ? void 0 : node.classList)) {
        return;
    }
    const classesToRemove = new Set();
    node.classList.forEach((cls) => {
        if (cls === null || cls === void 0 ? void 0 : cls.startsWith(exports.UNIQUE_LOOKUP_PREFIX)) {
            classesToRemove.add(cls);
        }
    });
    classesToRemove.forEach((cls) => {
        node.classList.remove(cls);
    });
    node.classList.add(`${exports.UNIQUE_LOOKUP_PREFIX}${uniqueLookup}`);
};
exports.addUniqueLookupAsClass = addUniqueLookupAsClass;
const addCodebaseIdToNode = (node, codebaseId) => {
    if (!(node === null || node === void 0 ? void 0 : node.classList)) {
        return;
    }
    const classesToRemove = new Set();
    node.classList.forEach((cls) => {
        if (!cls) {
            return;
        }
        if ((0, exports.getCodebaseIdFromClassName)(cls)) {
            classesToRemove.add(cls);
        }
    });
    classesToRemove.forEach((cls) => {
        node.classList.remove(cls);
    });
    node.classList.add(codebaseId);
};
exports.addCodebaseIdToNode = addCodebaseIdToNode;
const getElementKeyFromNode = (node) => {
    if (!(node === null || node === void 0 ? void 0 : node.classList)) {
        return null;
    }
    let clsFound = null;
    node.classList.forEach((cls) => {
        if (cls === null || cls === void 0 ? void 0 : cls.startsWith(exports.ELEMENT_KEY_PREFIX)) {
            clsFound = cls.substring(exports.ELEMENT_KEY_PREFIX.length);
        }
    });
    return clsFound;
};
exports.getElementKeyFromNode = getElementKeyFromNode;
const getUniqueLookupFromNode = (node) => {
    if (!(node === null || node === void 0 ? void 0 : node.classList)) {
        return null;
    }
    let clsFound = null;
    node.classList.forEach((cls) => {
        if (cls === null || cls === void 0 ? void 0 : cls.startsWith(exports.UNIQUE_LOOKUP_PREFIX)) {
            clsFound = cls.substring(exports.UNIQUE_LOOKUP_PREFIX.length);
        }
    });
    return clsFound;
};
exports.getUniqueLookupFromNode = getUniqueLookupFromNode;
const removeUniqueLookupFromNode = (node) => {
    if (!(node === null || node === void 0 ? void 0 : node.classList)) {
        return false;
    }
    const classesToRemove = new Set();
    node.classList.forEach((cls) => {
        if (cls === null || cls === void 0 ? void 0 : cls.startsWith(exports.UNIQUE_LOOKUP_PREFIX)) {
            classesToRemove.add(cls);
        }
    });
    classesToRemove.forEach((cls) => {
        node.classList.remove(cls);
    });
    return classesToRemove.size > 0;
};
exports.removeUniqueLookupFromNode = removeUniqueLookupFromNode;
const hasClass = (node, klass) => {
    if (!(node === null || node === void 0 ? void 0 : node.classList)) {
        return false;
    }
    let hasClass = false;
    node.classList.forEach((cls) => {
        if (cls == klass) {
            hasClass = true;
        }
    });
    return hasClass;
};
exports.hasClass = hasClass;
const isOutline = (node) => {
    return (0, exports.hasClass)(node, exports.OUTLINE_CLASS);
};
exports.isOutline = isOutline;
const getAllUnknownClasesFromList = (classes) => {
    return classes.filter((cls) => {
        if (!cls) {
            return false;
        }
        const isCodebaseId = (0, exports.getCodebaseIdFromClassName)(cls) !== null;
        const clsStartsWithKnownPrefix = KNOWN_CLASS_PREFIXES.some((prefix) => cls.startsWith(prefix));
        if (!clsStartsWithKnownPrefix && !KNOWN_CLASSES.has(cls) && !isCodebaseId) {
            return true;
        }
        return false;
    });
};
exports.getAllUnknownClasesFromList = getAllUnknownClasesFromList;
const getAllUnknownClasses = (node) => {
    if (!(node === null || node === void 0 ? void 0 : node.classList)) {
        return [];
    }
    return (0, exports.getAllUnknownClasesFromList)(Array.from(node.classList));
};
exports.getAllUnknownClasses = getAllUnknownClasses;
/**
 * Accepts a node from mutation observer and determines if it's a moving element.
 * Returns moving if and only if the node has the attribute `arb89-instant-update` set to true.
 * @param node
 * @returns
 */
const isMovingElement = (node) => {
    if (!node) {
        return false;
    }
    // Check if the node responds to getAttribute method.
    if (typeof node.getAttribute !== 'function') {
        return false;
    }
    return node.getAttribute(exports.TEMPO_INSTANT_UPDATE) === 'true';
};
exports.isMovingElement = isMovingElement;
const isSkipNavTreeNode = (node) => {
    if (!node) {
        return;
    }
    return node.getAttribute(exports.TEMPO_DO_NOT_SHOW_IN_NAV_UNTIL_REFRESH) === 'true';
};
exports.isSkipNavTreeNode = isSkipNavTreeNode;
/**
 * Check if the node has any parent that is an svg tag
 */
const isElementInSvg = (node, parent) => {
    var _a;
    if (!node) {
        return false;
    }
    if (parent && ((_a = node.tagName) === null || _a === void 0 ? void 0 : _a.toLowerCase()) === 'svg') {
        return true;
    }
    if (node.parentNode) {
        return (0, exports.isElementInSvg)(node.parentNode, true);
    }
    return false;
};
exports.isElementInSvg = isElementInSvg;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaWRlbnRpZmllclV0aWxzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2NoYW5uZWxNZXNzYWdpbmcvaWRlbnRpZmllclV0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLCtEQUsrQjtBQUUvQiw4Q0FBOEM7QUFDakMsUUFBQSxrQkFBa0IsR0FBRyxZQUFZLENBQUM7QUFDbEMsUUFBQSxvQkFBb0IsR0FBRyxlQUFlLENBQUMsQ0FBQyx3Q0FBd0M7QUFDaEYsUUFBQSxhQUFhLEdBQUcsZUFBZSxDQUFDO0FBQ2hDLFFBQUEsZ0JBQWdCLEdBQUcsd0JBQXdCLENBQUM7QUFDNUMsUUFBQSw0QkFBNEIsR0FBRyx3QkFBd0IsQ0FBQztBQUN4RCxRQUFBLGtDQUFrQyxHQUM3QyxvQ0FBb0MsQ0FBQztBQUMxQixRQUFBLG1DQUFtQyxHQUFHLGdCQUFnQixDQUFDO0FBQ3ZELFFBQUEsc0NBQXNDLEdBQ2pELGtDQUFrQyxDQUFDO0FBQ3hCLFFBQUEsaUNBQWlDLEdBQzVDLG1DQUFtQyxDQUFDO0FBRXRDLE1BQU0sYUFBYSxHQUFHLElBQUksR0FBRyxDQUFDO0lBQzVCLHFCQUFhO0lBQ2Isb0NBQTRCO0lBQzVCLDBDQUFrQztJQUNsQyw4Q0FBc0M7SUFDdEMseURBQW1DO0lBQ25DLGtEQUE0QjtJQUM1Qix3QkFBZ0I7Q0FDakIsQ0FBQyxDQUFDO0FBQ0gsTUFBTSxvQkFBb0IsR0FBRztJQUMzQiwwQkFBa0I7SUFDbEIsNEJBQW9CO0lBQ3BCLDJDQUFtQztJQUNuQyxrREFBNEI7SUFDNUIsb0NBQWM7Q0FDZixDQUFDO0FBRUYsMERBQTBEO0FBQzdDLFFBQUEsb0JBQW9CLEdBQUcsc0JBQXNCLENBQUM7QUFDOUMsUUFBQSwwQkFBMEIsR0FBRyw0QkFBNEIsQ0FBQztBQUMxRCxRQUFBLDBCQUEwQixHQUFHLDZCQUE2QixDQUFDO0FBQzNELFFBQUEsc0NBQXNDLEdBQ2pELDBCQUEwQixDQUFDO0FBQ2hCLFFBQUEsZ0JBQWdCLEdB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QUM3QyxJQUFJLENBQUMsSUFBSSxFQUFFO1FBQ1QsT0FBTztLQUNSO0lBRUQsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDLDhDQUFzQyxDQUFDLEtBQUssTUFBTSxDQUFDO0FBQzlFLENBQUMsQ0FBQztBQU5XLFFBQUEsaUJBQWlCLHFCQU01QjtBQUVGOztHQUVHO0FBQ0ksTUFBTSxjQUFjLEdBQUcsQ0FBQyxJQUFTLEVBQUUsTUFBZ0IsRUFBVyxFQUFFOztJQUNyRSxJQUFJLENBQUMsSUFBSSxFQUFFO1FBQ1QsT0FBTyxLQUFLLENBQUM7S0FDZDtJQUVELElBQUksTUFBTSxJQUFJLENBQUEsTUFBQSxJQUFJLENBQUMsT0FBTywwQ0FBRSxXQUFXLEVBQUUsTUFBSyxLQUFLLEVBQUU7UUFDbkQsT0FBTyxJQUFJLENBQUM7S0FDYjtJQUVELElBQUksSUFBSSxDQUFDLFVBQVUsRUFBRTtRQUNuQixPQUFPLElBQUEsc0JBQWMsRUFBQyxJQUFJLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxDQUFDO0tBQzlDO0lBRUQsT0FBTyxLQUFLLENBQUM7QUFDZixDQUFDLENBQUM7QUFkVyxRQUFBLGNBQWMsa0JBY3pCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQUREX0pTWF9QUkVGSVgsXG4gIERVUExJQ0FURV9QTEFDRUhPTERFUl9QUkVGSVgsXG4gIFRFTVBPUkFSWV9TVFlMSU5HX0NMQVNTX05BTUUsXG4gIFdSQVBfSU5fRElWX1BMQUNFSE9MREVSX0NPREVCQVNFX0lELFxufSBmcm9tICcuL2NoYW5nZUl0ZW1GdW5jdGlvbnMnO1xuXG4vLyBNdXN0IG1hdGNoIGlkZW50aWZpZXIgdXRpbHMgb24gdGhlIGZyb250ZW5kXG5leHBvcnQgY29uc3QgRUxFTUVOVF9LRVlfUFJFRklYID0gJ2FyYjg5LWtleS0nO1xuZXhwb3J0IGNvbnN0IFVOSVFVRV9MT09LVVBfUFJFRklYID0gJ2FyYjg5LWxvb2t1cC0nOyAvLyBVc2VkIG9ubHkgZm9yIHByb2Nlc3NpbmcgdGhlIG5hdiB0cmVlXG5leHBvcnQgY29uc3QgT1VUTElORV9DTEFTUyA9ICdhcmI4OS1vdXRsaW5lJztcbmV4cG9ydCBjb25zdCBFRElUX1RFWFRfQlVUVE9OID0gJ2FyYjg5LWVkaXQtdGV4dC1idXR0b24nO1xuZXhwb3J0IGNvbnN0IFRFTVBPX0lOU1RBTlRfRElWX0RSQVdfQ0xBU1MgPSAnYXJiODktaW5zdGFudC1kaXYtZHJhdyc7XG5leHBvcnQgY29uc3QgVEVNUE9fTU9WRV9CRVRXRUVOX1BBUkVOVFNfT1VUTElORSA9XG4gICdhcmI4OS1tb3ZlLWJldHdlZW4tcGFyZW50cy1vdXRsaW5lJztcbmV4cG9ydCBjb25zdCBURU1QT19JTlNUQU5UX1VQREFURV9TVFlMSU5HX1BSRUZJWCA9ICdhcmI4OS1zdHlsaW5nLSc7XG5leHBvcnQgY29uc3QgVEVNUE9fRElTUExBWV9OT05FX1VOVElMX1JFRlJFU0hfQ0xBU1MgPVxuICAnYXJiODktZGlzcGxheS1ub25lLXVudGlsLXJlZnJlc2gnO1xuZXhwb3J0IGNvbnN0IFRFTVBPX0RFTEVURV9BRlRFUl9JTlNUQU5UX1VQREFURSA9XG4gICdhcmI4OS1kZWxldGUtYWZ0ZXItaW5zdGFudC11cGRhdGUnO1xuXG5jb25zdCBLTk9XTl9DTEFTU0VTID0gbmV3IFNldChbXG4gIE9VVExJTkVfQ0xBU1MsXG4gIFRFTVBPX0lOU1RBTlRfRElWX0RSQVdfQ0xBU1MsXG4gIFRFTVBPX01PVkVfQkVUV0VFTl9QQVJFTlRTX09VVExJTkUsXG4gIFRFTVBPX0RJU1BMQVlfTk9ORV9VTlRJTF9SRUZSRVNIX0NMQVNTLFxuICBXUkFQX0lOX0RJVl9QTEFDRUhPTERFUl9DT0RFQkFTRV9JRCxcbiAgVEVNUE9SQVJZX1NUWUxJTkdfQ0xBU1NfTkFNRSxcbiAgRURJVF9URVhUX0JVVFRPTixcbl0pO1xuY29uc3QgS05PV05fQ0xBU1NfUFJFRklYRVMgPSBbXG4gIEVMRU1FTlRfS0VZX1BSRUZJWCxcbiAgVU5JUVVFX0xPT0tVUF9QUkVGSVgsXG4gIFRFTVBPX0lOU1RBTlRfVVBEQVRFX1NUWUxJTkdfUFJFRklYLFxuICBEVVBMSUNBVEVfUExBQ0VIT0xERVJfUFJFRklYLFxuICBBRERfSlNYX1BSRUZJWCxcbl07XG5cbi8vIEF0dHJpYnV0ZXMgdGhhdCBhcmUgc2V0IHVudGlsIHRoZSBuZXh0IE5hdiBUcmVlIFJlZnJlc2hcbmV4cG9ydCBjb25zdCBURU1QT19JTlNUQU5UX1VQREFURSA9ICdhcmI4OS1pbnN0YW50LXVwZGF0ZSc7XG5leHBvcnQgY29uc3QgVEVNUE9fREVMRVRFX0FGVEVSX1JFRlJFU0ggPSAnYXJiODktZGVsZXRlLWFmdGVyLXJlZnJlc2gnO1xuZXhwb3J0IGNvbnN0IFRFTVBPX09VVExJTkVfVU5USUxfUkVGRVNIID0gJ2FyYjg5LW91dGxpbmUtdW50aWwtcmVmcmVzaCc7XG5leHBvcnQgY29uc3QgVEVNUE9fRE9fTk9UX1NIT1dfSU5fTkFWX1VOVElMX1JFRlJFU0ggPVxuICAnYXJiODktZG8tbm90LXNob3ctaW4tbmF2JztcbmV4cG9ydCBjb25zdCBURU1QT19FTEVNRU5UX0lEID0gJ3RlbXBvZWxlbWVudGlkJztcbmV4cG9ydCBjb25zdCBURU1QT19URVNUX0lEID0gJ2RhdGEtdGVzdGlkJztcbmV4cG9ydCBjb25zdCBURU1QT19RVUVVRV9ERUxFVEVfQUZURVJfSE9UX1JFTE9BRCA9XG4gICdhcmI4OS1xdWV1ZS1kZWxldGUtYWZ0ZXItaG90LXJlbG9hZCc7XG5cbmV4cG9ydCBjb25zdCBLTk9XTl9BVFRSSUJVVEVTID0gbmV3IFNldChbXG4gIFRFTVBPX0lOU1RBTlRfVVBEQVRFLFxuICBURU1QT19ERUxFVEVfQUZURVJfUkVGUkVTSCxcbiAgVEVNUE9fREVMRVRFX0FGVEVSX0lOU1RBTlRfVVBEQVRFLFxuICBURU1QT19PVVRMSU5FX1VOVElMX1JFRkVTSCxcbiAgVEVNUE9fUVVFVUVfREVMRVRFX0FGVEVSX0hPVF9SRUxPQUQsXG4gIFRFTVBPX0RPX05PVF9TSE9XX0lOX05BVl9VTlRJTF9SRUZSRVNILFxuICBURU1QT19FTEVNRU5UX0lELFxuICBURU1QT19URVNUX0lELFxuXSk7XG5cbmV4cG9ydCBjb25zdCB2YWxpZGF0ZVV1aWQgPSAodXVpZDogc3RyaW5nKSA9PiB7XG4gIHJldHVybiBuZXcgUmVnRXhwKFxuICAgICdeWzAtOWEtZl17OH0tWzAtOWEtZl17NH0tWzEtNV1bMC05YS1mXXszfS1bODlhYl1bMC05YS1mXXszfS1bMC05YS1mXXsxMn0kJyxcbiAgICAnaScsXG4gICkudGVzdCh1dWlkKTtcbn07XG5cbmV4cG9ydCBjb25zdCBnZXRDb2RlYmFzZUlkRnJvbUNsYXNzTmFtZSA9IChcbiAgY2xhc3NOYW1lOiBzdHJpbmcsXG4pOiBzdHJpbmcgfCBudWxsID0+IHtcbiAgaWYgKFxuICAgIGNsYXNzTmFtZSAmJlxuICAgIGNsYXNzTmFtZS5zdGFydHNXaXRoKCd0ZW1wby0nKSAmJlxuICAgICh2YWxpZGF0ZVV1aWQoY2xhc3NOYW1lLnN1YnN0cmluZygndGVtcG8tJy5sZW5ndGgpKSB8fFxuICAgICAgY2xhc3NOYW1lID09PSBXUkFQX0lOX0RJVl9QTEFDRUhPTERFUl9DT0RFQkFTRV9JRCB8fFxuICAgICAgY2xhc3NOYW1lLnN0YXJ0c1dpdGgoRFVQTElDQVRFX1BMQUNFSE9MREVSX1BSRUZJWCkpXG4gICkge1xuICAgIHJldHVybiBjbGFzc05hbWU7XG4gIH1cblxuICByZXR1cm4gbnVsbDtcbn07XG5cbmV4cG9ydCBjb25zdCBnZXRDb2RlYmFzZUlkRnJvbU5vZGUgPSAobm9kZTogYW55KTogc3RyaW5nIHwgbnVsbCA9PiB7XG4gIGlmICghbm9kZT8uY2xhc3NMaXN0KSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBsZXQgY2xzRm91bmQ6IGFueSA9IG51bGw7XG4gIG5vZGUuY2xhc3NMaXN0LmZvckVhY2goKGNsczogc3RyaW5nKSA9PiB7XG4gICAgLy8gQSBiaXQgb2YgYSBoYWNrIC0+IGluIHRoZSBjYXNlIHdoZW4gdGhlcmUgYXJlIG11bHRpcGxlIHRlbXBvIGNvZGViYXNlIElEcyBvbiBhbiBlbGVtZW50XG4gICAgLy8gd2Ugd2FudCB0byB1c2UgdGhlIGZpcnN0IG9uZSBkZWZpbmVkLiBUaGlzIGhhcHBlbnMgaW4gdGhlIGNhc2Ugb2YgZm9yd2FyZCByZWZzLCBhbmQgd2VcbiAgICAvLyBhbHdheXMgYWRkIHRoZSBib3R0b20tbW9zdCBjbGFzc05hbWUgdG8gdGhlIGVuZCBvZiB0aGUgY2xhc3NlcyBsaXN0LCBzbyB3ZSB3YW50IHRvXG4gICAgLy8gc2hvdyB0aGUgdG9wLW1vc3QgZWxlbWVudCBpbiB0aGlzIGNhc2VcbiAgICBpZiAoY2xzRm91bmQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoIWNscykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGV4dHJhY3RlZElkID0gZ2V0Q29kZWJhc2VJZEZyb21DbGFzc05hbWUoY2xzKTtcbiAgICBpZiAoZXh0cmFjdGVkSWQpIHtcbiAgICAgIGNsc0ZvdW5kID0gZXh0cmFjdGVkSWQ7XG4gICAgfVxuICB9KTtcblxuICBpZiAoY2xzRm91bmQpIHtcbiAgICByZXR1cm4gY2xzRm91bmQ7XG4gIH1cblxuICBpZiAobm9kZT8udGFnTmFtZT8udG9Mb3dlckNhc2UoKSA9PSAnYm9keScpIHtcbiAgICByZXR1cm4gJ2JvZHknO1xuICB9XG5cbiAgaWYgKG5vZGU/LmlkID09ICdyb290Jykge1xuICAgIHJldHVybiAncm9vdCc7XG4gIH1cblxuICBpZiAobm9kZT8uaWQgPT0gJ19fbmV4dCcpIHtcbiAgICByZXR1cm4gJ19fbmV4dCc7XG4gIH1cblxuICByZXR1cm4gbnVsbDtcbn07XG5cbi8vIFRyYWNrIGhvdyBtYW55IHRpbWVzIHdlJ3ZlIHRyaWVkIHRvIGFkZCBhbiBlbGVtZW50IGtleSBjbGFzcyB0byBub2RlcyB0aGF0IGtlZXAgZ2V0dGluZyByZXNldFxuLy8gU29tZSBET00gZWxlbWVudHMgYXJlIGNvbnRyb2xsZWQgYnkgZXh0ZXJuYWwgbGlicmFyaWVzL2ZyYW1ld29ya3MgKGUuZy4gUHJvc2VNaXJyb3IpIGFuZCB3aWxsIHJlc2V0IGFueSBjbGFzc2VzIG9yXG4vLyB3aXBlIG91dCB0aGUgRE9NIGVsZW1lbnRzIGFuZCByZS1yZW5kZXIgdGhlbS5cbi8vIFdlIGRvbid0IHdhbnQgdG8ga2VlcCB0cnlpbmcgaW5kZWZpbml0ZWx5IHRvIGFkZCBjbGFzc2VzIHRvIHRoZXNlIGVsZW1lbnRzIHNpbmNlIGl0IHRoZSByZXNldCB3aWxsIHRyaWdnZXIgRE9NIHVwZGF0ZXNcbi8vIHdoaWNoIGFnYWluIHRyaWdnZXIgdGhlIG11dGF0aW9uIG9ic2VydmVyIGFuZCB3ZSdsbCBzdGFydCB0aGUgd2hvbGUgcHJvY2VzcyBvdmVyIGFnYWluLlxuY29uc3QgcmVzZXRDb3VudHMgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xuY29uc3QgUkVTRVRfQ09VTlRfVEhSRVNIT0xEID0gNTsgLy8gU3RvcCB0cnlpbmcgdG8gYWRkIGNsYXNzZXMgYWZ0ZXIgNSBmYWlsZWQgYXR0ZW1wdHNcblxuZXhwb3J0IGNvbnN0IGFkZEVsZW1lbnRLZXlBc0NsYXNzID0gKHtcbiAgbm9kZSxcbiAgc2FmZUVsZW1lbnRLZXksXG4gIGNvZGViYXNlSWQsXG59OiB7XG4gIG5vZGU6IGFueTtcbiAgc2FmZUVsZW1lbnRLZXk6IHN0cmluZztcbiAgY29kZWJhc2VJZD86IHN0cmluZztcbn0pID0+IHtcbiAgaWYgKCFub2RlPy5jbGFzc0xpc3QpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBsZXQgc3VjY2Vzc2Z1bGx5U2V0QmVmb3JlID0gZmFsc2U7XG5cbiAgY29uc3QgY2xhc3Nlc1RvUmVtb3ZlID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gIG5vZGUuY2xhc3NMaXN0LmZvckVhY2goKGNsczogc3RyaW5nKSA9PiB7XG4gICAgaWYgKGNscz8uc3RhcnRzV2l0aChFTEVNRU5UX0tFWV9QUkVGSVgpKSB7XG4gICAgICBzdWNjZXNzZnVsbHlTZXRCZWZvcmUgPSB0cnVlO1xuXG4gICAgICBjbGFzc2VzVG9SZW1vdmUuYWRkKGNscyk7XG4gICAgfVxuICB9KTtcblxuICAvLyBJZiB0aGlzIGVsZW1lbnQ6XG4gIC8vIDEuIERvZXNuJ3QgaGF2ZSBhIGNvZGViYXNlIElEIChtZWFuaW5nIGl0J3Mgbm90IG9uZSBvZiBvdXIgY29tcG9uZW50cylcbiAgLy8gMi4gSGFzIG5ldmVyIHN1Y2Nlc3NmdWxseSBrZXB0IG91ciBjbGFzcyBiZWZvcmVcbiAgLy8gMy4gSGFzIGhpdCB0aGUgcmVzZXQgdGhyZXNob2xkXG4gIC8vIFRoZW4gc3RvcCB0cnlpbmcgdG8gYWRkIGNsYXNzZXMgdG8gaXQgc2luY2UgaXQncyBsaWtlbHkgY29udHJvbGxlZCBleHRlcm5hbGx5XG4gIGlmIChcbiAgICAhY29kZWJhc2VJZCAmJlxuICAgICFzdWNjZXNzZnVsbHlTZXRCZWZvcmUgJiZcbiAgICAocmVzZXRDb3VudHMuZ2V0KHNhZmVFbGVtZW50S2V5KSB8fCAwKSA+PSBSRVNFVF9DT1VOVF9USFJFU0hPTERcbiAgKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY2xhc3Nlc1RvUmVtb3ZlLmZvckVhY2goKGNsczogc3RyaW5nKSA9PiB7XG4gICAgbm9kZS5jbGFzc0xpc3QucmVtb3ZlKGNscyk7XG4gIH0pO1xuXG4gIG5vZGUuY2xhc3NMaXN0LmFkZChgJHtFTEVNRU5UX0tFWV9QUkVGSVh9JHtzYWZlRWxlbWVudEtleX1gKTtcblxuICAvLyBGb3IgZWxlbWVudHMgd2l0aG91dCBhIGNvZGViYXNlIElEIHRoYXQgd2UgaGF2ZW4ndCBzdWNjZXNzZnVsbHkgYWRkZWQgYSBjbGFzcyB0byBiZWZvcmUsXG4gIC8vIGNoZWNrIGFmdGVyIGEgZGVsYXkgaWYgb3VyIGNsYXNzIHdhcyByZW1vdmVkIGJ5IGV4dGVybmFsIGNvZGVcbiAgLy8gSWYgc28sIGluY3JlbWVudCB0aGUgcmVzZXQgY291bnQgdG8gZXZlbnR1YWxseSBzdG9wIHRyeWluZ1xuICBpZiAoIWNvZGViYXNlSWQgJiYgIXN1Y2Nlc3NmdWxseVNldEJlZm9yZSkge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgIGAke0VMRU1FTlRfS0VZX1BSRUZJWH0ke3NhZmVFbGVtZW50S2V5fWAsXG4gICAgICApO1xuICAgICAgaWYgKCFlbGVtZW50KSB7XG4gICAgICAgIHJlc2V0Q291bnRzLnNldChcbiAgICAgICAgICBzYWZlRWxlbWVudEtleSxcbiAgICAgICAgICAocmVzZXRDb3VudHMuZ2V0KHNhZmVFbGVtZW50S2V5KSB8fCAwKSArIDEsXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSwgMTAwMCk7XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBhZGRVbmlxdWVMb29rdXBBc0NsYXNzID0gKG5vZGU6IGFueSwgdW5pcXVlTG9va3VwOiBzdHJpbmcpID0+IHtcbiAgaWYgKCFub2RlPy5jbGFzc0xpc3QpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBjbGFzc2VzVG9SZW1vdmUgPSBuZXcgU2V0PHN0cmluZz4oKTtcbiAgbm9kZS5jbGFzc0xpc3QuZm9yRWFjaCgoY2xzOiBzdHJpbmcpID0+IHtcbiAgICBpZiAoY2xzPy5zdGFydHNXaXRoKFVOSVFVRV9MT09LVVBfUFJFRklYKSkge1xuICAgICAgY2xhc3Nlc1RvUmVtb3ZlLmFkZChjbHMpO1xuICAgIH1cbiAgfSk7XG5cbiAgY2xhc3Nlc1RvUmVtb3ZlLmZvckVhY2goKGNsczogc3RyaW5nKSA9PiB7XG4gICAgbm9kZS5jbGFzc0xpc3QucmVtb3ZlKGNscyk7XG4gIH0pO1xuXG4gIG5vZGUuY2xhc3NMaXN0LmFkZChgJHtVTklRVUVfTE9PS1VQX1BSRUZJWH0ke3VuaXF1ZUxvb2t1cH1gKTtcbn07XG5cbmV4cG9ydCBjb25zdCBhZGRDb2RlYmFzZUlkVG9Ob2RlID0gKG5vZGU6IGFueSwgY29kZWJhc2VJZDogc3RyaW5nKSA9PiB7XG4gIGlmICghbm9kZT8uY2xhc3NMaXN0KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgY2xhc3Nlc1RvUmVtb3ZlID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gIG5vZGUuY2xhc3NMaXN0LmZvckVhY2goKGNsczogc3RyaW5nKSA9PiB7XG4gICAgaWYgKCFjbHMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoZ2V0Q29kZWJhc2VJZEZyb21DbGFzc05hbWUoY2xzKSkge1xuICAgICAgY2xhc3Nlc1RvUmVtb3ZlLmFkZChjbHMpO1xuICAgIH1cbiAgfSk7XG5cbiAgY2xhc3Nlc1RvUmVtb3ZlLmZvckVhY2goKGNsczogc3RyaW5nKSA9PiB7XG4gICAgbm9kZS5jbGFzc0xpc3QucmVtb3ZlKGNscyk7XG4gIH0pO1xuXG4gIG5vZGUuY2xhc3NMaXN0LmFkZChjb2RlYmFzZUlkKTtcbn07XG5cbmV4cG9ydCBjb25zdCBnZXRFbGVtZW50S2V5RnJvbU5vZGUgPSAobm9kZTogYW55KTogc3RyaW5nIHwgbnVsbCA9PiB7XG4gIGlmICghbm9kZT8uY2xhc3NMaXN0KSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBsZXQgY2xzRm91bmQgPSBudWxsO1xuICBub2RlLmNsYXNzTGlzdC5mb3JFYWNoKChjbHM6IHN0cmluZykgPT4ge1xuICAgIGlmIChjbHM/LnN0YXJ0c1dpdGgoRUxFTUVOVF9LRVlfUFJFRklYKSkge1xuICAgICAgY2xzRm91bmQgPSBjbHMuc3Vic3RyaW5nKEVMRU1FTlRfS0VZX1BSRUZJWC5sZW5ndGgpO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBjbHNGb3VuZDtcbn07XG5cbmV4cG9ydCBjb25zdCBnZXRVbmlxdWVMb29rdXBGcm9tTm9kZSA9IChub2RlOiBhbnkpOiBzdHJpbmcgfCBudWxsID0+IHtcbiAgaWYgKCFub2RlPy5jbGFzc0xpc3QpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGxldCBjbHNGb3VuZCA9IG51bGw7XG4gIG5vZGUuY2xhc3NMaXN0LmZvckVhY2goKGNsczogc3RyaW5nKSA9PiB7XG4gICAgaWYgKGNscz8uc3RhcnRzV2l0aChVTklRVUVfTE9PS1VQX1BSRUZJWCkpIHtcbiAgICAgIGNsc0ZvdW5kID0gY2xzLnN1YnN0cmluZyhVTklRVUVfTE9PS1VQX1BSRUZJWC5sZW5ndGgpO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBjbHNGb3VuZDtcbn07XG5cbmV4cG9ydCBjb25zdCByZW1vdmVVbmlxdWVMb29rdXBGcm9tTm9kZSA9IChub2RlOiBhbnkpOiBib29sZWFuID0+IHtcbiAgaWYgKCFub2RlPy5jbGFzc0xpc3QpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBjb25zdCBjbGFzc2VzVG9SZW1vdmUgPSBuZXcgU2V0PHN0cmluZz4oKTtcbiAgbm9kZS5jbGFzc0xpc3QuZm9yRWFjaCgoY2xzOiBzdHJpbmcpID0+IHtcbiAgICBpZiAoY2xzPy5zdGFydHNXaXRoKFVOSVFVRV9MT09LVVBfUFJFRklYKSkge1xuICAgICAgY2xhc3Nlc1RvUmVtb3ZlLmFkZChjbHMpO1xuICAgIH1cbiAgfSk7XG5cbiAgY2xhc3Nlc1RvUmVtb3ZlLmZvckVhY2goKGNsczogc3RyaW5nKSA9PiB7XG4gICAgbm9kZS5jbGFzc0xpc3QucmVtb3ZlKGNscyk7XG4gIH0pO1xuXG4gIHJldHVybiBjbGFzc2VzVG9SZW1vdmUuc2l6ZSA+IDA7XG59O1xuXG5leHBvcnQgY29uc3QgaGFzQ2xhc3MgPSAobm9kZTogYW55LCBrbGFzczogc3RyaW5nKTogYm9vbGVhbiA9PiB7XG4gIGlmICghbm9kZT8uY2xhc3NMaXN0KSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgbGV0IGhhc0NsYXNzID0gZmFsc2U7XG4gIG5vZGUuY2xhc3NMaXN0LmZvckVhY2goKGNsczogc3RyaW5nKSA9PiB7XG4gICAgaWYgKGNscyA9PSBrbGFzcykge1xuICAgICAgaGFzQ2xhc3MgPSB0cnVlO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBoYXNDbGFzcztcbn07XG5cbmV4cG9ydCBjb25zdCBpc091dGxpbmUgPSAobm9kZTogYW55KTogYm9vbGVhbiA9PiB7XG4gIHJldHVybiBoYXNDbGFzcyhub2RlLCBPVVRMSU5FX0NMQVNTKTtcbn07XG5cbmV4cG9ydCBjb25zdCBnZXRBbGxVbmtub3duQ2xhc2VzRnJvbUxpc3QgPSAoY2xhc3Nlczogc3RyaW5nW10pOiBzdHJpbmdbXSA9PiB7XG4gIHJldHVybiBjbGFzc2VzLmZpbHRlcigoY2xzKSA9PiB7XG4gICAgaWYgKCFjbHMpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCBpc0NvZGViYXNlSWQgPSBnZXRDb2RlYmFzZUlkRnJvbUNsYXNzTmFtZShjbHMpICE9PSBudWxsO1xuXG4gICAgY29uc3QgY2xzU3RhcnRzV2l0aEtub3duUHJlZml4ID0gS05PV05fQ0xBU1NfUFJFRklYRVMuc29tZSgocHJlZml4KSA9PlxuICAgICAgY2xzLnN0YXJ0c1dpdGgocHJlZml4KSxcbiAgICApO1xuXG4gICAgaWYgKCFjbHNTdGFydHNXaXRoS25vd25QcmVmaXggJiYgIUtOT1dOX0NMQVNTRVMuaGFzKGNscykgJiYgIWlzQ29kZWJhc2VJZCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBnZXRBbGxVbmtub3duQ2xhc3NlcyA9IChub2RlOiBhbnkpOiBzdHJpbmdbXSA9PiB7XG4gIGlmICghbm9kZT8uY2xhc3NMaXN0KSB7XG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgcmV0dXJuIGdldEFsbFVua25vd25DbGFzZXNGcm9tTGlzdChBcnJheS5mcm9tKG5vZGUuY2xhc3NMaXN0KSk7XG59O1xuXG4vKipcbiAqIEFjY2VwdHMgYSBub2RlIGZyb20gbXV0YXRpb24gb2JzZXJ2ZXIgYW5kIGRldGVybWluZXMgaWYgaXQncyBhIG1vdmluZyBlbGVtZW50LlxuICogUmV0dXJucyBtb3ZpbmcgaWYgYW5kIG9ubHkgaWYgdGhlIG5vZGUgaGFzIHRoZSBhdHRyaWJ1dGUgYGFyYjg5LWluc3RhbnQtdXBkYXRlYCBzZXQgdG8gdHJ1ZS5cbiAqIEBwYXJhbSBub2RlXG4gKiBAcmV0dXJuc1xuICovXG5leHBvcnQgY29uc3QgaXNNb3ZpbmdFbGVtZW50ID0gKG5vZGU6IGFueSk6IGJvb2xlYW4gPT4ge1xuICBpZiAoIW5vZGUpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvLyBDaGVjayBpZiB0aGUgbm9kZSByZXNwb25kcyB0byBnZXRBdHRyaWJ1dGUgbWV0aG9kLlxuICBpZiAodHlwZW9mIG5vZGUuZ2V0QXR0cmlidXRlICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIG5vZGUuZ2V0QXR0cmlidXRlKFRFTVBPX0lOU1RBTlRfVVBEQVRFKSA9PT0gJ3RydWUnO1xufTtcblxuZXhwb3J0IGNvbnN0IGlzU2tpcE5hdlRyZWVOb2RlID0gKG5vZGU6IGFueSkgPT4ge1xuICBpZiAoIW5vZGUpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICByZXR1cm4gbm9kZS5nZXRBdHRyaWJ1dGUoVEVNUE9fRE9fTk9UX1NIT1dfSU5fTkFWX1VOVElMX1JFRlJFU0gpID09PSAndHJ1ZSc7XG59O1xuXG4vKipcbiAqIENoZWNrIGlmIHRoZSBub2RlIGhhcyBhbnkgcGFyZW50IHRoYXQgaXMgYW4gc3ZnIHRhZ1xuICovXG5leHBvcnQgY29uc3QgaXNFbGVtZW50SW5TdmcgPSAobm9kZTogYW55LCBwYXJlbnQ/OiBib29sZWFuKTogYm9vbGVhbiA9PiB7XG4gIGlmICghbm9kZSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGlmIChwYXJlbnQgJiYgbm9kZS50YWdOYW1lPy50b0xvd2VyQ2FzZSgpID09PSAnc3ZnJykge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgaWYgKG5vZGUucGFyZW50Tm9kZSkge1xuICAgIHJldHVybiBpc0VsZW1lbnRJblN2Zyhub2RlLnBhcmVudE5vZGUsIHRydWUpO1xuICB9XG5cbiAgcmV0dXJuIGZhbHNlO1xufTtcbiJdfQ==